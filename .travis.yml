sudo: required

language: generic

services:
  - docker

before_install:
  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce

jobs:
  include:
    - stage: test
      script: docker-compose -f docker-compose-integration.yml up --abort-on-container-exit
    - stage: package
      script: docker build -f Dockerfile.deploy .

stages:
  - test
  - name: package
    if: branch = master